{% set record_title = notification.context.record_title %}
{% set record_url = notification.context.record_url %}
{% set endorsement_status = notification.context.endorsement_status %}
{% set actor_name = notification.context.actor_name %}
{% set account_settings_link = invenio_url_for("invenio_notifications_settings.index") %}
{% set WORKFLOW_STATUS_ANNOUNCE_REVIEW = notification.context.WORKFLOW_STATUS_ANNOUNCE_REVIEW %}
{% set WORKFLOW_STATUS_REJECT = notification.context.WORKFLOW_STATUS_REJECT %}
{% set WORKFLOW_STATUS_TENTATIVE_ACCEPT = notification.context.WORKFLOW_STATUS_TENTATIVE_ACCEPT %}
{% set WORKFLOW_STATUS_TENTATIVE_REJECT = notification.context.WORKFLOW_STATUS_TENTATIVE_REJECT %}

{%- macro get_status_message(status, record_title, actor_name) -%}
{%- if status == WORKFLOW_STATUS_ANNOUNCE_REVIEW -%}
{{ _("Your record '{record_title}' has received a peer review notification from '{actor_name}'.").format(
    record_title=record_title, actor_name=actor_name
) }}
{%- elif status == WORKFLOW_STATUS_REJECT -%}
{{ _("Your endorsement request for '{record_title}' has been rejected by '{actor_name}'.").format(
    record_title=record_title, actor_name=actor_name
) }}
{%- elif status == WORKFLOW_STATUS_TENTATIVE_ACCEPT -%}
{{ _("Your endorsement request for '{record_title}' has been tentatively accepted by '{actor_name}'.").format(
    record_title=record_title, actor_name=actor_name
) }}
{%- elif status == WORKFLOW_STATUS_TENTATIVE_REJECT -%}
{{ _("Your endorsement request for '{record_title}' needs revision. "
   "Please update your request and resubmit for review by '{actor_name}'.").format(
    record_title=record_title, actor_name=actor_name
) }}
{%- else -%}
{{ _("Your endorsement request for '{record_title}' status has been updated to "
   "'{endorsement_status}' by '{actor_name}'.").format(
    record_title=record_title, endorsement_status=status, actor_name=actor_name
) }}
{%- endif -%}
{%- endmacro -%}

{%- block subject -%}
{%- if endorsement_status == WORKFLOW_STATUS_ANNOUNCE_REVIEW -%}
{{ _("ðŸ”Ž Review notification for '{record_title}'").format(record_title=record_title) }}
{%- else -%}
{{ _("ðŸ“‹ Endorsement request status update for '{record_title}'").format(record_title=record_title) }}
{%- endif -%}
{%- endblock subject -%}

{%- block html_body -%}
<table style="font-family:'Lato',Helvetica,Arial,sans-serif;border-spacing:15px">
    <tr>
        <td>
            {{ get_status_message(endorsement_status, record_title, actor_name) }}
        </td>
    </tr>
    <tr>
        <td>
            <a href="{{ record_url }}" class="button">{{ _("View your record")}}</a>
        </td>
    </tr>
    {% if endorsement_status == WORKFLOW_STATUS_TENTATIVE_REJECT %}
    <tr>
        <td style="background-color:#fff3cd;border:1px solid #ffeaa7;padding:10px;border-radius:4px">
            <strong>{{ _("Action Required:") }}</strong>
            {{ _("Please review the feedback, update your endorsement request, "
               "and resubmit for consideration.") }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td><strong>â€”â€”â€”â€”</strong></td>
    </tr>
    <tr>
        <td style="font-size:smaller">
            {{ _("This is an auto-generated message. To manage notifications, visit your") }}
            <a href="{{ account_settings_link }}">{{ _("account settings") }}</a>.
        </td>
    </tr>
</table>
{%- endblock html_body %}

{%- block plain_body -%}
{{ get_status_message(endorsement_status, record_title, actor_name) }}
{% if endorsement_status == WORKFLOW_STATUS_TENTATIVE_REJECT %}
{{ _("ACTION REQUIRED: Please review the feedback, update your endorsement request, "
   "and resubmit for consideration.") }}
{% endif %}

{{ _("View your record: {record_url}").format(record_url=record_url) }}

â€”
{{ _("This is an auto-generated message. To manage notifications, "
   "visit your account settings at:") }}
{{ account_settings_link }}
{%- endblock plain_body %}

{%- block md_body -%}
{% if endorsement_status == WORKFLOW_STATUS_ANNOUNCE_REVIEW %}
    {{ _("Your record *{record_title}* has received a peer review notification from *{actor_name}*.").format(
        record_title=record_title, actor_name=actor_name
    ) }}
{% elif endorsement_status == WORKFLOW_STATUS_REJECT %}
    {{ _("Your endorsement request for *{record_title}* has been **rejected** by *{actor_name}*.").format(
        record_title=record_title, actor_name=actor_name
    ) }}
{% elif endorsement_status == WORKFLOW_STATUS_TENTATIVE_ACCEPT %}
    {{ _("Your endorsement request for *{record_title}* has been **tentatively accepted** "
       "by *{actor_name}*.").format(
        record_title=record_title, actor_name=actor_name
    ) }}
{% elif endorsement_status == WORKFLOW_STATUS_TENTATIVE_REJECT %}
    {{ _("Your endorsement request for *{record_title}* **needs revision**. "
       "Please update your request and resubmit for review by *{actor_name}*.").format(
        record_title=record_title, actor_name=actor_name
    ) }}

    **{{ _("ACTION REQUIRED") }}:**
    {{ _("Please review the feedback, update your endorsement request, "
       "and resubmit for consideration.") }}
{% else %}
    {{ _("Your endorsement request for *{record_title}* status has been updated to "
       "**{endorsement_status}** by *{actor_name}*.").format(
        record_title=record_title, endorsement_status=endorsement_status, actor_name=actor_name
    ) }}
{% endif %}

[{{ _("View your record") }}]({{ record_url }})

â€”
{{ _("This is an auto-generated message. To manage notifications, visit your") }}
[{{ _("account settings") }}]({{ account_settings_link }}).
{%- endblock md_body %}
